<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>颜值测评</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Outfit:wght@200;300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --black: #0a0a0a;
    --panel: #161616;
    --border: #252525;
    --gold: #c9a84c;
    --gold-dim: #8a6f2e;
    --gold-light: #e8c96a;
    --white: #f0ece4;
    --gray: #666;
    --mid-gray: #444;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--black); color: var(--white); font-family: 'Outfit', sans-serif; font-weight: 300; min-height: 100vh; }

  header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 28px 48px; border-bottom: 1px solid var(--border);
  }
  .logo { font-family: 'Cormorant Garamond', serif; font-size: 1.6rem; font-weight: 300; letter-spacing: 0.1em; }
  .logo em { color: var(--gold); font-style: italic; }
  .header-badge { font-size: 0.6rem; letter-spacing: 0.3em; text-transform: uppercase; color: var(--gray); border: 1px solid var(--border); padding: 5px 14px; }

  main { max-width: 1100px; margin: 0 auto; padding: 56px 48px; display: grid; grid-template-columns: 380px 1fr; gap: 48px; align-items: start; }

  .left { display: flex; flex-direction: column; gap: 24px; }

  .field-label { font-size: 0.6rem; letter-spacing: 0.25em; text-transform: uppercase; color: var(--gold); margin-bottom: 10px; }

  .api-wrap input {
    width: 100%; padding: 12px 16px; background: var(--panel); border: 1px solid var(--border);
    color: var(--white); font-family: 'Outfit', sans-serif; font-size: 0.82rem; outline: none; transition: border-color 0.2s;
  }
  .api-wrap input:focus { border-color: var(--gold-dim); }
  .api-wrap input::placeholder { color: var(--mid-gray); }
  .api-note { font-size: 0.68rem; color: var(--gray); margin-top: 6px; line-height: 1.5; }
  .api-note a { color: var(--gold-dim); text-decoration: none; }

  .gender-row { display: flex; gap: 8px; }
  .gender-btn {
    flex: 1; padding: 10px; background: var(--panel); border: 1px solid var(--border);
    color: var(--gray); font-family: 'Outfit', sans-serif; font-size: 0.8rem;
    cursor: pointer; transition: all 0.2s; letter-spacing: 0.05em;
  }
  .gender-btn:hover { border-color: var(--gold-dim); color: var(--white); }
  .gender-btn.active { background: var(--gold); border-color: var(--gold); color: var(--black); font-weight: 500; }

  .upload-zone {
    border: 1px dashed var(--border); background: var(--panel); min-height: 300px;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    gap: 12px; cursor: pointer; position: relative; transition: all 0.3s; text-align: center; padding: 32px;
  }
  .upload-zone:hover, .upload-zone.drag-over { border-color: var(--gold-dim); background: #1a1a1a; }
  .upload-zone input { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; }
  .upload-icon { width: 52px; height: 52px; border: 1px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; color: var(--gray); margin-bottom: 4px; }
  .upload-zone p { font-size: 0.85rem; color: var(--gray); }
  .upload-zone small { font-size: 0.7rem; color: var(--mid-gray); }
  #preview-img { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; display: none; }

  .analyze-btn {
    width: 100%; padding: 15px; background: var(--gold); border: none;
    color: var(--black); font-family: 'Outfit', sans-serif; font-size: 0.85rem;
    font-weight: 500; letter-spacing: 0.1em; text-transform: uppercase; cursor: pointer; transition: all 0.25s;
  }
  .analyze-btn:hover:not(:disabled) { background: var(--gold-light); }
  .analyze-btn:disabled { opacity: 0.4; cursor: not-allowed; }

  .error-msg { display: none; background: #1a0e0e; border-left: 2px solid #8b3a3a; padding: 10px 14px; font-size: 0.78rem; color: #c07070; line-height: 1.6; }

  .right { position: sticky; top: 32px; }
  .result-box { background: var(--panel); border: 1px solid var(--border); min-height: 560px; padding: 36px; }

  .placeholder-state { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 500px; gap: 14px; text-align: center; }
  .placeholder-num { font-family: 'Cormorant Garamond', serif; font-size: 8rem; color: #1a1a1a; line-height: 1; }
  .placeholder-state p { font-size: 0.8rem; color: var(--gray); max-width: 200px; line-height: 1.7; }

  .loading-state { display: none; flex-direction: column; align-items: center; justify-content: center; min-height: 500px; gap: 20px; }
  .spinner { width: 32px; height: 32px; border: 1px solid var(--border); border-top-color: var(--gold); border-radius: 50%; animation: spin 0.9s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-state p { font-size: 0.8rem; color: var(--gray); letter-spacing: 0.05em; }

  .result-content { display: none; }

  /* Big score */
  .big-score-area { text-align: center; padding: 24px 0 28px; border-bottom: 1px solid var(--border); margin-bottom: 28px; }
  .score-circle {
    width: 110px; height: 110px; border-radius: 50%; border: 1px solid var(--gold-dim);
    margin: 0 auto 16px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative;
  }
  .score-circle::before { content: ''; position: absolute; inset: 5px; border-radius: 50%; border: 1px solid var(--border); }
  .score-num { font-family: 'Cormorant Garamond', serif; font-size: 2.8rem; font-weight: 300; color: var(--gold); line-height: 1; }
  .score-den { font-size: 0.62rem; color: var(--gray); letter-spacing: 0.1em; margin-top: 2px; }
  .score-title { font-family: 'Cormorant Garamond', serif; font-size: 1.4rem; font-style: italic; color: var(--white); margin-bottom: 6px; }
  .score-desc { font-size: 0.75rem; color: var(--gray); line-height: 1.7; max-width: 260px; margin: 0 auto; }

  /* Sub scores */
  .sub-score-item { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
  .sub-label { font-size: 0.7rem; color: var(--gray); width: 70px; flex-shrink: 0; }
  .sub-bar { flex: 1; height: 1px; background: var(--border); position: relative; }
  .sub-bar-fill { height: 100%; background: linear-gradient(to right, var(--gold-dim), var(--gold)); }
  .sub-val { font-size: 0.7rem; color: var(--gold); width: 30px; text-align: right; flex-shrink: 0; }

  .r-section { margin-bottom: 24px; }
  .r-section-title {
    font-size: 0.6rem; letter-spacing: 0.25em; text-transform: uppercase;
    color: var(--gold); margin-bottom: 12px; display: flex; align-items: center; gap: 10px;
  }
  .r-section-title::after { content: ''; flex: 1; height: 1px; background: var(--border); }
  .r-section p { font-size: 0.8rem; color: #999; line-height: 1.8; }

  .tag { display: inline-block; padding: 3px 10px; border: 1px solid var(--border); font-size: 0.68rem; color: var(--gray); margin: 3px 3px 3px 0; letter-spacing: 0.05em; }
  .tag.gold { border-color: var(--gold-dim); color: var(--gold); }

  .rec-item { margin-bottom: 14px; }
  .rec-item-title { font-size: 0.78rem; color: var(--white); margin-bottom: 3px; font-weight: 400; }
  .rec-item-detail { font-size: 0.75rem; color: #888; line-height: 1.7; }

  @media (max-width: 768px) {
    main { grid-template-columns: 1fr; padding: 32px 20px; gap: 32px; }
    header { padding: 20px 24px; }
    .right { position: static; }
  }
</style>
</head>
<body>

<header>
  <div class="logo">颜值 <em>Studio</em></div>
  <div class="header-badge">AI · Beauty Analysis</div>
</header>

<main>
  <div class="left">

    <div>
      <div class="field-label">Claude API Key</div>
      <div class="api-wrap">
        <input type="password" id="api-key" placeholder="sk-ant-api03-..." />
      </div>
      <div class="api-note">前往 <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a> 免费注册获取 · 仅在你的浏览器本地使用</div>
    </div>

    <div>
      <div class="field-label">性别参考</div>
      <div class="gender-row">
        <button class="gender-btn active" data-gender="男生">男生</button>
        <button class="gender-btn" data-gender="女生">女生</button>
        <button class="gender-btn" data-gender="不限">不限</button>
      </div>
    </div>

    <div>
      <div class="field-label">上传自拍照片</div>
      <div class="upload-zone" id="upload-zone">
        <img id="preview-img" alt="preview" />
        <div id="upload-placeholder">
          <div class="upload-icon">◎</div>
          <p>点击或拖拽上传照片</p>
          <small>JPG / PNG · 建议正脸照</small>
        </div>
        <input type="file" id="file-input" accept="image/*" />
      </div>
    </div>

    <button class="analyze-btn" id="analyze-btn" disabled>
      <span id="btn-text">请先上传照片</span>
    </button>

    <div class="error-msg" id="error-msg"></div>
  </div>

  <div class="right">
    <div class="result-box">

      <div class="placeholder-state" id="placeholder-state">
        <div class="placeholder-num">∞</div>
        <p>上传照片，AI 将从五个维度全面分析你的颜值与形象</p>
      </div>

      <div class="loading-state" id="loading-state">
        <div class="spinner"></div>
        <p>AI 正在分析中，请稍候…</p>
      </div>

      <div class="result-content" id="result-content">

        <div class="big-score-area">
          <div class="score-circle">
            <div class="score-num" id="total-score">—</div>
            <div class="score-den">/ 100</div>
          </div>
          <div class="score-title" id="score-title">—</div>
          <div class="score-desc" id="score-desc">—</div>
        </div>

        <div class="r-section">
          <div class="r-section-title">分项评分</div>
          <div id="sub-scores"></div>
        </div>

        <div class="r-section">
          <div class="r-section-title">你的优点</div>
          <div id="highlights"></div>
        </div>

        <div class="r-section">
          <div class="r-section-title">可提升空间</div>
          <p id="improvements"></p>
        </div>

        <div class="r-section">
          <div class="r-section-title">发型推荐</div>
          <div id="hairstyle-recs"></div>
        </div>

        <div class="r-section">
          <div class="r-section-title">穿搭风格推荐</div>
          <div id="outfit-recs"></div>
        </div>

        <div class="r-section">
          <div class="r-section-title">你的气质标签</div>
          <div id="style-tags"></div>
        </div>

      </div>
    </div>
  </div>
</main>

<script>
  let selectedGender = '男生';
  let uploadedBase64 = null;
  let uploadedType = null;

  document.querySelectorAll('.gender-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.gender-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      selectedGender = btn.dataset.gender;
    });
  });

  const uploadZone = document.getElementById('upload-zone');
  const fileInput = document.getElementById('file-input');
  const previewImg = document.getElementById('preview-img');
  const uploadPlaceholder = document.getElementById('upload-placeholder');

  uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.classList.add('drag-over'); });
  uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('drag-over'));
  uploadZone.addEventListener('drop', e => {
    e.preventDefault(); uploadZone.classList.remove('drag-over');
    const file = e.dataTransfer.files[0];
    if (file && file.type.startsWith('image/')) handleFile(file);
  });
  fileInput.addEventListener('change', e => { if (e.target.files[0]) handleFile(e.target.files[0]); });

  function handleFile(file) {
    const reader = new FileReader();
    reader.onload = e => {
      const result = e.target.result;
      uploadedBase64 = result.split(',')[1];
      uploadedType = file.type;
      previewImg.src = result;
      previewImg.style.display = 'block';
      uploadPlaceholder.style.display = 'none';
      document.getElementById('analyze-btn').disabled = false;
      document.getElementById('btn-text').textContent = '开始颜值测评';
    };
    reader.readAsDataURL(file);
  }

  document.getElementById('analyze-btn').addEventListener('click', analyze);

  async function analyze() {
    const apiKey = document.getElementById('api-key').value.trim();
    if (!apiKey) { showError('请先填写 Claude API Key'); return; }
    if (!uploadedBase64) { showError('请先上传照片'); return; }

    hideError();
    setLoading(true);

    const prompt = `你是一位专业的形象顾问和颜值分析师。请分析这张照片中人物的颜值和整体形象，以${selectedGender}审美标准为参考。

只返回以下 JSON 格式，不要任何其他文字和代码块标记：

{
  "total_score": 整数0-100,
  "score_title": "简短评价标题如清爽阳光型或精致五官派，4-8字",
  "score_desc": "30字以内综合评价",
  "sub_scores": {
    "五官精致度": 整数0-100,
    "脸型轮廓": 整数0-100,
    "皮肤状态": 整数0-100,
    "气质神韵": 整数0-100,
    "整体协调": 整数0-100
  },
  "highlights": ["优点1", "优点2", "优点3"],
  "improvements": "可以提升的地方，温和友善，50字以内",
  "hairstyle_recs": [
    { "name": "发型名称", "reason": "为什么适合" },
    { "name": "发型名称", "reason": "为什么适合" },
    { "name": "发型名称", "reason": "为什么适合" }
  ],
  "outfit_recs": [
    { "style": "穿搭风格", "detail": "具体建议" },
    { "style": "穿搭风格", "detail": "具体建议" },
    { "style": "穿搭风格", "detail": "具体建议" }
  ],
  "style_tags": ["标签1", "标签2", "标签3", "标签4", "标签5"]
}

请友善积极，注重鼓励，给出真实有建设性的建议。`;

    try {
      const res = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': apiKey,
          'anthropic-version': '2023-06-01',
          'anthropic-dangerous-direct-browser-access': 'true'
        },
        body: JSON.stringify({
          model: 'claude-opus-4-6',
          max_tokens: 1500,
          messages: [{
            role: 'user',
            content: [
              { type: 'image', source: { type: 'base64', media_type: uploadedType, data: uploadedBase64 } },
              { type: 'text', text: prompt }
            ]
          }]
        })
      });

      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        throw new Error(err.error?.message || `请求失败 (${res.status})`);
      }

      const data = await res.json();
      const text = data.content[0].text.trim().replace(/```json|```/g, '').trim();
      const result = JSON.parse(text);
      renderResult(result);
    } catch (err) {
      showError('分析失败：' + err.message);
    } finally {
      setLoading(false);
    }
  }

  function renderResult(r) {
    document.getElementById('total-score').textContent = r.total_score;
    document.getElementById('score-title').textContent = r.score_title;
    document.getElementById('score-desc').textContent = r.score_desc;

    const scoreEl = document.getElementById('total-score');
    scoreEl.style.color = r.total_score >= 80 ? '#e8c96a' : r.total_score >= 60 ? '#c9a84c' : '#8a6f2e';

    const subEl = document.getElementById('sub-scores');
    subEl.innerHTML = '';
    for (const [label, val] of Object.entries(r.sub_scores)) {
      subEl.innerHTML += `
        <div class="sub-score-item">
          <div class="sub-label">${label}</div>
          <div class="sub-bar"><div class="sub-bar-fill" style="width:${val}%"></div></div>
          <div class="sub-val">${val}</div>
        </div>`;
    }

    document.getElementById('highlights').innerHTML = r.highlights.map(h => `<span class="tag gold">${h}</span>`).join('');
    document.getElementById('improvements').textContent = r.improvements;

    document.getElementById('hairstyle-recs').innerHTML = r.hairstyle_recs.map(h => `
      <div class="rec-item">
        <div class="rec-item-title">✦ ${h.name}</div>
        <div class="rec-item-detail">${h.reason}</div>
      </div>`).join('');

    document.getElementById('outfit-recs').innerHTML = r.outfit_recs.map(o => `
      <div class="rec-item">
        <div class="rec-item-title">✦ ${o.style}</div>
        <div class="rec-item-detail">${o.detail}</div>
      </div>`).join('');

    document.getElementById('style-tags').innerHTML = r.style_tags.map(t => `<span class="tag">${t}</span>`).join('');

    document.getElementById('placeholder-state').style.display = 'none';
    document.getElementById('result-content').style.display = 'block';
  }

  function setLoading(on) {
    const btn = document.getElementById('analyze-btn');
    if (on) {
      btn.disabled = true;
      document.getElementById('btn-text').textContent = '分析中…';
      document.getElementById('loading-state').style.display = 'flex';
      document.getElementById('placeholder-state').style.display = 'none';
      document.getElementById('result-content').style.display = 'none';
    } else {
      btn.disabled = false;
      document.getElementById('btn-text').textContent = '重新测评';
      document.getElementById('loading-state').style.display = 'none';
    }
  }

  function showError(msg) { const el = document.getElementById('error-msg'); el.textContent = msg; el.style.display = 'block'; }
  function hideError() { document.getElementById('error-msg').style.display = 'none'; }
</script>
</body>
</html>
